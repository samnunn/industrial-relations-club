<!DOCTYPE html>
<html lang="en">
<head>
    <title>Industrial Relations</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#111111" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <!-- The site's favicon is the "pager" [Twemoji](https://github.com/twitter/twemoji) converted to .ico via [favicon.io](https://favicon.io/). Copyright 2020 Twitter, Inc and other contributors. Graphics licensed under CC-BY 4.0. -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="wrapper">
        <header>
            <h1 id="site-title">Industrial Relations<span class="tiny">.club</span></h1>
        </header>
        <main>
            <section class="card">
                <h2>Pay Scale</h2>
                <div class="form-row">
                    <select name="rate-selector" id="rate-selector" class="selector">
                        <option data-payscale-epoch-pd-allowance="5810" data-payscale-epoch-annual-salary="80479" value="80479">Intern</option>
                        <option data-payscale-epoch-pd-allowance="5810" data-payscale-epoch-annual-salary="88328" value="88328">Resident Medical Officer Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="5810" data-payscale-epoch-annual-salary="96960" value="96960">Resident Medical Officer Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="5810" data-payscale-epoch-annual-salary="106456" value="106456">Resident Medical Officer Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="111678" value="111678">Registrar Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="117163" value="117163">Registrar Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="125800" value="125800">Registrar Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="131990" value="131990" data-payscale-epoch-oncall>Registrar Yr 4</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="138489" value="138489">Registrar Yr 5</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="145314" value="145314">Registrar Yr 6</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="152479" value="152479">Registrar Yr 7</option>
                        <option data-payscale-epoch-pd-allowance="14524" data-payscale-epoch-annual-salary="163766" value="163766">Senior Registrar Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="14524" data-payscale-epoch-annual-salary="171854" value="171854">Senior Registrar Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="111678" value="111678">Supervised Medical Officer Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="117163" value="117163">Supervised Medical Officer Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="125800" value="125800">Supervised Medical Officer Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="131990" value="131990">Supervised Medical Officer Yr 4</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="138489" value="138489">Supervised Medical Officer Yr 5</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="145314" value="145314">Supervised Medical Officer Yr 6</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="152479" value="152479">Supervised Medical Officer Yr 7</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="163766" value="163766">Supervised Medical Officer Yr 8</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="171854" value="171854">Supervised Medical Officer Yr 9</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="117163" value="117163">Trainee Medical Administrator Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="125800" value="125800">Trainee Medical Administrator Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="131990" value="131990">Trainee Medical Administrator Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="138489" value="138489">Trainee Medical Administrator Yr 4</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="145314" value="145314">Trainee Medical Administrator Yr 5</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="152479" value="152479">Trainee Medical Administrator Yr 6</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="163766" value="163766">Trainee Medical Administrator Yr 7</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="125800" value="125800">Trainee Psychiatrist Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="131990" value="131990">Trainee Psychiatrist Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="138489" value="138489">Trainee Psychiatrist Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="145314" value="145314">Trainee Psychiatrist Yr 4</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="152479" value="152479">Trainee Psychiatrist Yr 5</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="163766" value="163766">Trainee Psychiatrist Yr 6</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="171854" value="171854">Trainee Psychiatrist Yr 7</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="117163" value="117163">Trainee Public Health Physician Yr 1</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="125800" value="125800">Trainee Public Health Physician Yr 2</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="131990" value="131990">Trainee Public Health Physician Yr 3</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="138489" value="138489">Trainee Public Health Physician Yr 4</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="145314" value="145314">Trainee Public Health Physician Yr 5</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="152479" value="152479">Trainee Public Health Physician Yr 6</option>
                        <option data-payscale-epoch-pd-allowance="10167" data-payscale-epoch-annual-salary="163766" value="163766">Trainee Public Health Physician Yr 7</option>                        
                    </select>
                </div>
            </section>
            <section class="card">
                <h2>Hourly Rates</h2>
                <table class="pay-rates">
                    <tbody>
                        <tr>
                            <td>
                                <p>Weekdays</p>
                                <p class="note">8:00 am til 6:00 pm</p>
                            </td>
                            <td data-payscale-scale="1.0">
                                <p></p>
                                <p class="note"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Evenings</p>
                                <p class="note">6:00 pm til midnight</p>
                            </td>
                            <td data-payscale-scale="1.2"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Weeknights</p>
                                <p class="note">midnight til 8:00 am</p>
                            </td>
                            <td data-payscale-scale="1.25"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Saturdays</p>
                                <p class="note">midnight til midnight</p>
                            </td>
                            <td data-payscale-scale="1.5"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Sundays</p>
                                <p class="note">midnight til 8:00 am Monday</p>
                            </td>
                            <td data-payscale-scale="1.75"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Public Holidays</p>
                                <p class="note">midnight til 8:00 am the next day</p>
                            </td>
                            <td data-payscale-scale="2.5"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Overtime</p>
                                <p class="note">80 to 120 hours</p>
                            </td>
                            <td data-payscale-scale="1.5"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>Mega Overtime</p>
                                <p class="note">over 120 hours</p>
                            </td>
                            <td data-payscale-scale="2.0"></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section class="card">
                <h2>Salary <span class="tiny">(full time)</span></h2>
                <table class="pay-rates">
                    <tbody>
                        <tr>
                            <td>
                                <p>Base Pay</p>
                                <!-- <p class="note">full time</p> -->
                            </td>
                            <td>
                                <p class="dollars" id="annual-rate"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>PD Allowance</p>
                                <p class="note">Paid in fortnightly installments<span id="pd-allowance-fortnightly"></span></p>
                            </td>
                            <td>
                                <p class="dollars" id="pd-allowance–yearly"></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section class="card">
                <h2>Leave Entitlements <span class="tiny">(full time)</span></h2>
                <table class="pay-rates">
                    <tbody>
                        <tr>
                            <td>
                                <p>Sick Leave</p>
                            </td>
                            <td>
                                <p>80 hours</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Annual Leave</p>
                            </td>
                            <td>
                                <p>160 hours</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>PD Leave (Accruing)</p>
                            </td>
                            <td>
                                <p>1 week</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>PD Leave (Non-accruing)</p>
                                <p class="note">accrues if declined</p>
                            </td>
                            <td>
                                <p>2 weeks</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Additional Leave</p>
                                <!-- <p class="note">credited every October</p> -->
                            </td>
                            <td>
                                <p>≤ 40 hours</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p>Eight hours of additional leave is granted when you:</p>
                <ul>
                    <li>Work seven Sundays or public holidays</li>
                    <li>Complete 120 hours on call</li>
                </ul>
                <p>Additional leave is credited to your balance once per year, usually in October. You can use it just like your normal annual leave.</p>
            </section>
            <section class="card">
                <h2>Recall Rates</h2>
                <table class="pay-rates">
                    <tbody>
                        <tr>
                            <td>
                                <p>On Call</p>
                                <p class="note">18.75% of Registrar Yr 4</p>
                            </td>
                            <td>
                                <p class="dollars" id="oncall-rate"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>First three hours</p>
                                <p class="note">6:00 am til midnight</p>
                            </td>
                            <td data-payscale-scale="1.5"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>First three hours on Sundays</p>
                                <p class="note">6:00 am til midnight</p>
                            </td>
                            <td data-payscale-scale="1.75"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>First three hours at night</p>
                                <p class="note">midnight til 6:00 am</p>
                            </td>
                            <td data-payscale-scale="2.0"></td>
                        </tr>
                        <tr>
                            <td>
                                <p>All subsequent hours</p>
                                <p class="note">any time of day</p>
                            </td>
                            <td data-payscale-scale="2.0"></td>
                        </tr>
                    </tbody>
                </table>
                <p>You always get paid for at least three hours.</p>
            </section>
            <section class="card">
                <h2>Meal Allowances</h2>
                <p>You get a meal allowance if food is not provided and your shift lasts for more than 10 hours (excluding breaks).</p>
                <table class="pay-rates">
                    <tbody>
                        <tr>
                            <td>
                                <p>Breakfast</p>
                            </td>
                            <td>
                                <p class="dollars">12.05</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Lunch</p>
                            </td>
                            <td>
                                <p class="dollars">14.85</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Dinner</p>
                            </td>
                            <td>
                                <p class="dollars">17.80</p>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p>Supper</p>
                            </td>
                            <td>
                                <p class="dollars">12.05</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p>Rates are periodically updated in Schedule H of the <a href="https://www.wairc.wa.gov.au/resources/awards/?id=PUB007">Public Service Award (1992)</a>.</p>
            </section>
            <section class="card">
                <h2>Shift Calculator</h2>
                <div id="shift-checker" class="shift-data">
                    <div class="form-row">
                        <label for="">
                            Date
                            <input class="shift-input" type="date" value="2023-01-01" min="2022-07-01" required>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>
                            Start Time
                            <input class="shift-input" type="time" step="900" value="08:00:00" required>
                        </label>
                    </div>
                    <div class="form-row">
                        <label for="shift-duration-input">Duration (hours)
                            <div class="number-clicker">
                                <div>-</div>
                                <input id="shift-duration-input" class="shift-input" type="number" inputmode="decimal" value="8.0" min="3" max="72" step="0.01" required>
                                <div>+</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-row">
                        <label>
                            Shift Type
                            <div class="selector-container">
                                <select name="shift-type-selector" id="shift-type-selector" class="selector" required>
                                    <option value="normal">Normal</option>
                                    <option value="oncall">On Call</option>
                                    <option value="recall">Recall</option>
                                </select>
                            </div>
                        </label>
                    </div>
                    <p id="shift-checker-readout"></p>
                </div>
            </section>
            <section class="card">
                <h2>Trends <span class="tiny">(new)</span></h2>
                <img src="/attachments/dit-pay-trends.svg" id="dit-pay-trends" class="svg-darkmode" alt="The percentage change in DiT salaries from 2018-2023 plotted alongside the percentage change in the Consumer Price Index (CPI), AHPRA fees, and the median cost of renting a unit in Perth." title="Number go up.">
                <h3>Data Sources</h3>
                <ul>
                    <li>
                        <b>Your Salary</b> is the percentage change in an <a href="/attachments/AMA%20WA%20Industrial%20Agreement%20%282022%29.pdf">intern's salary</a> since 2018. Since all DiT salaries increase at the same rate, this represents wage growth at all levels.
                    </li>
                    <li>
                        <b>Inflation</b> is the consumer price index (CPI) for the September quarter in that year, as reported by the <a href="https://www.abs.gov.au/statistics/economy/price-indexes-and-inflation/consumer-price-index-australia">Australian Bureau of Statistics</a>. Though it's not a perfect measure of inflation, it's the best one we have.
                    </li>
                    <li>
                        <b>AHPRA Fees</b> are the annual fees for general registration published on <a href="https://www.medicalboard.gov.au/Registration/Fees.aspx">APHRA's website</a>. Historical fees were accessed using <a href="https://web.archive.org/">The Internet Archive</a>.
                    </li>
                    <li>
                        <b>Perth Rent</b> is the median weekly rent paid for a unit in Perth during the September quarter in that year, as reported by <a href="https://web.archive.org/web/20231227004422/https://reiwa.com.au/the-wa-market/perth-metro/">REIWA</a>.
                    </li>
                </ul>
                <p>The complete dataset is available on <a href="https://github.com/samnunn/industrial-relations-club">GitHub</a>.</p>
            </section>
            <section class="card">
                <h2>Top Tips</h2>
                <ol>
                    <li>When overtime claims is refused, your head of department must provide reasons in writing</li>
                    <li>If your leave application is declined, they are required to tell you <i>when</i> you can take leave</li>
                    <li>Where possible, rosters will be published 21 days prior to their commencement</li>
                    <li>You should be rostered off every second weekend</li>
                    <li>If you are too tired to drive, you get a taxi voucher home and back to work</li>
                    <li>You can’t be rostered on more than four nights in a row, or five if the total hours are ≤ 50</li>
                    <li>Shifts starting after midday cannot last more than 12 hours</li>
                    <li>You are entitled to a paid 30 minute break every shift</li>
                    <li>If you have not taken leave for one year, you only need to give two weeks’ notice before taking it (there is no application)</li>
                    <li>If you don’t work on a public holiday, you still get eight hours of non-penalty pay</li>
                </ol>
            </section>
            <!-- <section class="card">
                <h2>Payslip Reader <span class="tiny">(beta)</span></h2>    
                <form action="/upload" method=post enctype=multipart/form-data id="slip-form">
                    <label class="btn no-select" for="slip-input">Upload Payslip</label>
                    <input id="slip-input" class="invisible" type=file name=file multiple>
                </form>
            </section> -->
            <section class="card">
                <h2>Sources</h2>
                <ul>
                    <li><a href="/attachments/AMA%20WA%20Industrial%20Agreement%20%282022%29.pdf">AMA WA Industrial Agreement (2022)</a></li>
                    <li><a href="https://www.wairc.wa.gov.au/resources/awards/?id=PUB007">Public Service Award (1992)</a></li>
                    <li><a href="https://web.archive.org/web/20230604183824/https://www.wa.gov.au/organisation/department-of-treasury/wages-policy">WA's New Wages Policy (2022)</a></li>
                </ul>
            </section>
        </main>
        <footer>
            <p>Last updated <span id="last-updated">2024-01-30</span>. <a href="https://github.com/samnunn/industrial-relations-club">Source.</a></p>
        </footer>
    </div>
    <script>
        /*
        ┌─────────────────────────────────────────────────────────────────┐
        │                   ____  _   _ ___ _____ _____                   │
        │                  / ___|| | | |_ _|  ___|_   _|                  │
        │                  \___ \| |_| || || |_    | |                    │
        │                   ___) |  _  || ||  _|   | |                    │
        │                  |____/|_| |_|___|_|     |_|                    │
        │                                                                 │
        │    ____    _    _     ____ _   _ _        _  _____ ___  ____    │
        │   / ___|  / \  | |   / ___| | | | |      / \|_   _/ _ \|  _ \   │
        │  | |     / _ \ | |  | |   | | | | |     / _ \ | || | | | |_) |  │
        │  | |___ / ___ \| |__| |___| |_| | |___ / ___ \| || |_| |  _ <   │
        │   \____/_/   \_\_____\____|\___/|_____/_/   \_\_| \___/|_| \_\  │
        │                                                                 │
        └─────────────────────────────────────────────────────────────────┘
        
        # What It Does
        1. Takes the user-entered shift information from the DOM (createModelFromUserEnteredShifts)
        2. Breaks the shifts into chunks of sixty minutes or less (breakShiftIntoChunks)
        3. Uses the start time of each chunk to work out what rate it should be paid at (calculatePayRateForChunk)
        4. Aggregates applicable pay rates and how much time was worked at each rate
        5. Multiplies rates x time worked to calculate how much money is owed
        
        # Rounding Behaviour
        - HSS rounds to the nearest cent after the total amount owed **in each penalty rate** is calculated
        - It's not per-shift or per-payslip
        - Although our payslips report an hourly rate of $40.07 for an intern, it's actually 83609 / (52.1666 * 40) = $40.06826207 that gets used in pay calculations
        - The placement of every .toFixed() in this code is deliberate, so be mindful when making changes
        
        */
        shiftList = document.querySelector('#shift-checker tbody')
        
        function createModelFromUserEnteredShifts() {
            // Take information from the user-entered shifts and return an array of dicts
            // Originally designed to be rows in a table, but was later rationalised to be a single shift
            // The for () loop will only ever iterate once, in the current configuration
            let shifts = []
            let userEnteredShifts = document.querySelectorAll('.shift-data')
            
            for (s of userEnteredShifts) {
                // Extract user data from <input> elements
                let shiftStartDate = s.querySelector('input[type="date"]').valueAsDate
                let shiftStartTime = s.querySelector('input[type="time"]').valueAsDate
                let shiftDurationInHours = s.querySelector('input[type="number"]').value
                let shiftType = s.querySelector('#shift-type-selector').value
                
                // Skip if incomplete information is provided
                if (!shiftStartDate || !shiftStartTime || !shiftDurationInHours) {
                    console.warn('Invalid row')
                    break
                }
                
                // Amalgamate shift date + time inputs into one JS Date object @ UTC
                // shiftStartDate is always UTC midnight on the date entered by the user
                // this adds the expected hour and minute offsets
                let shiftStartDateTimeUTC = shiftStartDate
                shiftStartDateTimeUTC.setUTCHours(shiftStartTime.getUTCHours())
                shiftStartDateTimeUTC.setUTCMinutes(shiftStartTime.getUTCMinutes())
                
                // Save to model
                shifts.push({
                    'start_utc': shiftStartDateTimeUTC,
                    'duration_in_minutes': shiftDurationInHours * 60,
                    'shift_type': shiftType,
                })
            }
            
            return shifts
        }
        
        function breakShiftIntoChunks(startTime, shiftDurationInMinutes, chunkDurationInMinutes) {
            // chunk shift into n minute intervals (60 % chunkDurationInMinutes should be zero)
            // the first chunk will run from the nominated start time until the next even multiple of chunkDurationInMinutes
            // the last chunk will run from the last even multiple of chunkDurationInMinutes until the nominated end time
            
            let minutesSinceMidnight = startTime.getUTCHours() * 60 + startTime.getUTCMinutes()
            let intervalCount = Math.ceil(minutesSinceMidnight / chunkDurationInMinutes)
            
            // set variables for first iteration
            let currentChunkStart = minutesSinceMidnight
            let currentChunkEnd = intervalCount * chunkDurationInMinutes
            
            // Initialise chunks[] with first chunk
            // This is often shorter than chunkDurationInMinutes because shifts don't always start at the top of the hour
            chunks = [
            [currentChunkStart, currentChunkEnd]
            ]
            
            // Keep adding chunks until the shift length is reached
            while (true) {
                currentChunkStart = currentChunkEnd
                if (currentChunkEnd + chunkDurationInMinutes <= minutesSinceMidnight + shiftDurationInMinutes) {
                    // Create a new chunk extending beyond the end of the last one by chunkDurationInMinutes
                    currentChunkEnd += chunkDurationInMinutes
                    chunks.push([currentChunkStart, currentChunkEnd])
                } else {
                    // Stop when the end of the new chunk would go over shiftDurationInMinutes
                    // Instead, return a short chunk with the remainder of the time in the shift (always < shiftDurationInMinutes)
                    currentChunkEnd = minutesSinceMidnight + shiftDurationInMinutes
                    chunks.push([currentChunkStart, currentChunkEnd])
                    break
                }
            }
            
            return chunks
        }
        
        
        function calculatePayRateForChunk(chunk, shift, timeElapsedInMinutes, standardHourlyRate) {
            // Returns the pay rate in dollars (unrounded) for the provided chunk
            // Uses a 'bid' system to find the highest applicable rate
            // That means all possible rates get evaluated
            // Some efficiencies *could* be gained here, but at the cost of much poorer maintainability/readability
            
            // Initialise bids list
            bids = []
            
            // Create a Date object that represents midnight the day the shift started
            let midnight = s['start_utc']
            midnight.setUTCHours(0,0,0,0) // h, m, s, ms = 0
            
            // Make consisely-named variables avaiable to the rule matching logic
            chunkStartDateTime = new Date(midnight.valueOf() + c[0] * 60 * 1000)
            let day = chunkStartDateTime.getUTCDay()
            let hours = chunkStartDateTime.getUTCHours() // hour of the day at the START of the chunk
            
            // Weekdays (Monday mornings special-cased below)
            if (day <= 5 && day >= 1) {
                if (hours >= 0 && hours < 8) {          // 0000 - 0800
                    bids.push(1.25)
                } else if (hours >= 8 && hours < 18) {  // 0800 - 1800
                    bids.push(1.0)
                } else if (hours >= 18 && hours < 24) { // 1800 - 2400
                    bids.push(1.2)
                }
                
            }
            
            // Saturdays (0000 - 2400)
            if (day == 6) {
                bids.push(1.5)
            }
            
            // Sundays and the following monday
            if (day == 0) {
                bids.push(1.75)
            }
            if (day == 1 && hours >= 0 && hours < 8) {
                bids.push(1.75)
            }
            
            // Public holidays
            // 0000 - 2400 on the day
            // 0000 - 0800 the day after
            
            // Overtime (minor) timeElapsedInMinutes
            // Overtime (major) timeElapsedInMinutes
            
            // Recall
            if (shift['shift_type'] == 'recall') {
                if (timeElapsedInMinutes < 3 * 60) { // First three hours
                    if (hours >= 6) { // Weekdays
                        bids.push(1.5)
                        console.log('recall weekday')
                    } else if (day == 0 && hours >= 6)  { // Sundays
                        console.log('recall sunday')
                        bids.push(1.75)
                    } else if (hours >= 0 && hours < 6) { // Nights
                        console.log('recall night')
                        bids.push(2.0)
                    }
                    
                } else { // Subseqent hours
                    bids.push(2.0)
                    console.log('recall > 3 hours')
                }
            }
            
            // Assign the final pay rate for this chunk to the highest bidder
            let winner = bids.sort((a, b) => b - a)[0]
            return winner * standardHourlyRate
        }
        
        
        function calculateRosterValue() {
            // Calculates the total pay due for the roster provided
            // All date logic will be carried out at UTC
            
            // Make model of the user-entered shifts
            let shifts = createModelFromUserEnteredShifts()
            
            // get hourly rates
            standardHourlyRate = getAnnualRate() / (40 * 52.1666)
            
            // Iterate over each shift…
            let timeWorkedInThisRosterInMinutes = 0
            let totalPay = 0
            let penalties = {}
            
            for (s of shifts) {
                // ON CALL
                switch (s['shift_type']) {
                    case 'oncall':
                    let onCallHourlyRate = getOnCallHourlyRate()
                    if (!penalties[onCallHourlyRate]) { penalties[onCallHourlyRate] = 0 }
                    penalties[onCallHourlyRate] += s['duration_in_minutes']
                    break
                    
                    case 'leave':
                    // deliberately ignores penalty rates (not offered for leave)
                    if (!penalties[standardHourlyRate]) { penalties[standardHourlyRate] = 0 }
                    penalties[standardHourlyRate] += s['duration_in_minutes']
                    break
                    
                    default:
                    // Catches recall and routine shifts
                    // Recall still needs a "bid" process because sometimes the other penalty rates are higher than the recall rate
                    
                    // Break shift into chunks
                    chunks = breakShiftIntoChunks(s['start_utc'], s['duration_in_minutes'], 60)
                    
                    // Iterate over chunks and add their values to penalties{}
                    for (c of chunks) {
                        // Get pay rate for this chunk
                        payRate = calculatePayRateForChunk(c, s, timeWorkedInThisRosterInMinutes, standardHourlyRate)
                        // Get duration of this chunk
                        timeForThisChunkInMinutes = c[1] - c[0]
                        // Add to penalties model
                        if (!penalties[payRate]) { penalties[payRate] = 0 } // default to zero if undefined
                        penalties[payRate] += timeForThisChunkInMinutes
                        // Add to total time worked
                        timeWorkedInThisRosterInMinutes += timeForThisChunkInMinutes
                    }
                }
            }
            
            // Multiply each penalty by the hours worked while earning it
            console.log(penalties)
            for (penalty in penalties) {
                pay = (penalty * (penalties[penalty] / 60)).toFixed(2)
                pay = parseFloat(pay) // toFixed returns a String, needs to be converted bac
                totalPay += pay
            }
            // Cha-ching!
            return totalPay
        }
        
        // SHIFT DURATION INPUT BUTTONS
        const minusButton = document.querySelector('div.number-clicker > div:first-of-type')
        const plusButton = document.querySelector('div.number-clicker > div:last-of-type')
        const hoursInput = document.querySelector('div.number-clicker input[type="number"]')
        
        const max = parseFloat(hoursInput.getAttribute('max'))
        const min = parseFloat(hoursInput.getAttribute('min'))
        const increment = 0.5
        
        minusButton.addEventListener('click', (e) => {
            e.preventDefault() // prevent mobile devices from showing the keyboard
            if (parseFloat(hoursInput.value) >= min + increment) {
                let current = parseFloat(hoursInput.value)
                current = current - increment
                replacement = Math.round(current / increment) * increment
                hoursInput.value = replacement.toFixed(1)
                updateRosterValueReadout()
            }
        })
        plusButton.addEventListener('click', (e) => {
            e.preventDefault() // prevent mobile devices from showing the keyboard
            if (parseFloat(hoursInput.value) <= max - increment) {
                let current = parseFloat(hoursInput.value)
                current = current + increment
                replacement = Math.round(current / increment) * increment
                hoursInput.value = replacement.toFixed(1)
                updateRosterValueReadout()
            }
        })
        
        const timeInput = document.querySelector('input[type="time"]');
        
        timeInput.addEventListener('focusout', () => {
            const timeValue = timeInput.value
            const timeParts = timeValue.split(":")
            let hours = parseInt(timeParts[0], 10)
            let minutes = parseInt(timeParts[1], 10)
            
            // Round minutes to the nearest 15 minutes
            minutes = Math.round(minutes / 15) * 15
            if (minutes === 60) {
                minutes = 0
                hours++
            }
            
            // Convert hours and minutes back to string format
            const roundedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`
            
            // Set the rounded time back to the input value
            timeInput.value = roundedTime
        })
        
        function updateRosterValueReadout() {
            value = calculateRosterValue().toFixed(2)
            value = insertThousandsSeparator(value)
            document.querySelector('#shift-checker-readout').innerText = `$${value}`
        }
        
        // auto-execute
        const inputs = document.querySelectorAll('#shift-checker input, select')
        for (i of inputs) {
            i.addEventListener('input', (e) => {
                updateRosterValueReadout()
            })
        }
        /*
        ┌─────────────────────────────────────────────────────────────────┐
        │        ____   _ __   __  ____   ____    _    _     _____        │
        │       |  _ \ / \\ \ / / / ___| / ___|  / \  | |   | ____|       │
        │       | |_) / _ \\ V /  \___ \| |     / _ \ | |   |  _|         │
        │       |  __/ ___ \| |    ___) | |___ / ___ \| |___| |___        │
        │       |_| /_/   \_\_|   |____/ \____/_/   \_\_____|_____|       │
        │                                                                 │
        │    ____    _    _     ____ _   _ _        _  _____ ___  ____    │
        │   / ___|  / \  | |   / ___| | | | |      / \|_   _/ _ \|  _ \   │
        │  | |     / _ \ | |  | |   | | | | |     / _ \ | || | | | |_) |  │
        │  | |___ / ___ \| |__| |___| |_| | |___ / ___ \| || |_| |  _ <   │
        │   \____/_/   \_\_____\____|\___/|_____/_/   \_\_| \___/|_| \_\  │
        │                                                                 │
        └─────────────────────────────────────────────────────────────────
        */
        function insertThousandsSeparator(x) {
            return x
            .toString()
            .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function correctForAnnualSalaryAdjustment(dollars, percentageAdjustmentOnlyMode=false) {
            const epochDate = new Date('2022-06-30')
            const currentDate = new Date()
            const diff = currentDate - epochDate
            const yearDelta = Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25))
            
            // WA's New Wages Policy policy states that we will have an annual pay rise of 3% or $60 per week, whichever is greater
            // https://web.archive.org/web/20230604183824/https://www.wa.gov.au/organisation/department-of-treasury/wages-policy
            
            // this loop has to exist because the agreement rounds to whole dollars each year
            percentageAdjustedDollars = dollars
            sixtyMeaslyDollarIncrement = dollars
            for (i = 0; i < yearDelta; i++) {
                // generate 3% increment
                percentageAdjustedDollars = (percentageAdjustedDollars * 1.03).toFixed(0)
                // generate $60 per week increment
                sixtyMeaslyDollarIncrement = (parseFloat(sixtyMeaslyDollarIncrement) + (52.1666 * 60)).toFixed(0)
            }
            
            // could technically be more efficient, but meh
            if (percentageAdjustmentOnlyMode == true) {
                return percentageAdjustedDollars
            } else {
                // return the larger of the two
                return percentageAdjustedDollars > sixtyMeaslyDollarIncrement ? percentageAdjustedDollars : sixtyMeaslyDollarIncrement
            }
        }
        
        // does not round to two digits because it's used to calculate on-call pay, which is sensitive to rounding errors
        function getOnCallHourlyRate() {
            onCallAnnualRate = document.querySelector('[data-payscale-epoch-oncall]').getAttribute('data-payscale-epoch-annual-salary')
            onCallAnnualRate = correctForAnnualSalaryAdjustment(onCallAnnualRate)
            onCallHourlyRate = ((0.1875 * onCallAnnualRate) / (40 * 52.1666))
            return onCallHourlyRate
        }
        
        function getAnnualRate() {
            annualRate = parseFloat(rateSelector.value)
            annualRate = correctForAnnualSalaryAdjustment(annualRate)
            return annualRate
        }
        
        rateSelector = document.querySelector('#rate-selector')
        
        function updateRates() {
            // annual rate
            annualRate = getAnnualRate()
            annualRateReadout = document.querySelector('#annual-rate')
            annualRateReadout.innerText = insertThousandsSeparator(annualRate)
            
            // hourly rates
            hourlyRate = (annualRate / (40 * 52.1666)).toFixed(2)
            scaledRateReadouts = document.querySelectorAll('[data-payscale-scale]')
            for (s of scaledRateReadouts) {
                payScale = s.getAttribute('data-payscale-scale')
                payScale = parseFloat(payScale)
                scaledRate = (hourlyRate * payScale).toFixed(2)
                s.innerHTML = `<p class="dollars">${scaledRate}</p><p class="note">${payScale}x</p>`
            }
            
            // pd allowance
            pdAllowance = rateSelector.options[rateSelector.selectedIndex].getAttribute('data-payscale-epoch-pd-allowance')
            pdAllowance = correctForAnnualSalaryAdjustment(pdAllowance, true)
            
            pdAllowanceYearlyReadout = document.querySelector('#pd-allowance–yearly')
            pdAllowanceYearlyReadout.innerText = insertThousandsSeparator(pdAllowance)
            
            pdAllowanceFornightlyReadout = document.querySelector('#pd-allowance-fortnightly')
            pdAllowanceFornightlyReadout.innerText = ` of $${(2* pdAllowance / 52.1666).toFixed(2)}`
            
            // on call rate
            onCallHourlyRate = getOnCallHourlyRate()
            onCallHourlyRate = onCallHourlyRate.toFixed(2)
            onCallReadout = document.querySelector('#oncall-rate')
            onCallReadout.innerText = onCallHourlyRate
        }
        
        rateSelector.addEventListener('change', (e) => {
            updateRates()
            updateRosterValueReadout()
        })
        
        window.addEventListener('load', (e) => {
            // Initialise pay rates
            updateRates()
            // Initialise roster calcualtor
            updateRosterValueReadout()
            // Set date to today
            datePicker = document.querySelector('.shift-data input[type="date"]')
            now = new Date()
            let day = now.getDate()
            day = String(day).padStart(2, "0")
            let month = now.getMonth()
            month = parseInt(month)
            month = month + 1
            month = String(month).padStart(2, "0")
            let year = now.getFullYear()
            datePicker.value = `${year}-${month}-${day}`
        })
    </script>
</body>
</html>